<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflex Checker Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .container {
            width: 100%;
            height: 100vh;
        }

        #gameBox {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--game-box-bg, white);
        }

        .ball {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
        }

        .disappear {
            animation: disappear 0.5s forwards;
        }

        @keyframes disappear {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        #startPopup,
        #endPopup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--popup-bg, white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 10;
            display: none;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        [data-theme="dark"] {
            --popup-bg: #1a202c;
            --game-box-bg: #2d3748;
            --text-color: #a0aec0;
            --primary-color: #63b3ed;
        }

        [data-theme="light"] {
            --popup-bg: white;
            --game-box-bg: white;
            --text-color: #2d3748;
            --primary-color: #3182ce;
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen" data-theme="light">
    <div id="overlay"></div>
    <div id="startPopup">
        <h2 class="text-2xl font-semibold mb-4" style="color: var(--text-color)">Start Reflex Checker Game</h2>
        <label for="timeInput" class="block text-sm font-medium mb-2" style="color: var(--text-color)">Select Timer
            (seconds):</label>
        <input type="number" id="timeInput"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            min="10" max="120" value="60">
        <div class="mt-4">
            <input type="checkbox" id="themeToggle" class="mr-2">
            <label for="themeToggle" class="text-sm font-medium" style="color: var(--text-color)">Dark Mode</label>
        </div>
        <button id="startButton"
            class="mt-4 py-2 px-4 bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700 focus:outline-none">Start
            Game</button>
    </div>

    <div id="endPopup">
        <h2 class="text-2xl font-semibold mb-4" style="color: var(--text-color)">Game Over</h2>
        <p id="finalScore" class="mb-4" style="color: var(--text-color)">Your best reflex time is: N/A</p>
        <h3 class="text-lg font-semibold mb-2" style="color: var(--text-color)">Reflexes Log:</h3>
        <ul id="reflexesLog" class="mb-4 list-disc list-inside" style="color: var(--text-color)"></ul>
        <button id="restartButton"
            class="mt-4 py-2 px-4 bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700 focus:outline-none">Restart
            Game</button>
    </div>

    <div class="container mx-auto">
        <div
            class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col items-center justify-center w-full h-full">
            <div id="gameBox" class="relative w-full h-full">
                <div id="timer" class="absolute top-0 left-0 m-2 text-lg font-bold" style="color: var(--text-color)">
                    Timer: 60</div>
                <div id="reflexScore" class="absolute top-0 right-0 m-2 text-lg font-bold"
                    style="color: var(--text-color)">Best Reflex: N/A</div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const gameBox = document.getElementById("gameBox");
            const timerDisplay = document.getElementById("timer");
            const reflexScoreDisplay = document.getElementById("reflexScore");
            const startPopup = document.getElementById("startPopup");
            const endPopup = document.getElementById("endPopup");
            const overlay = document.getElementById("overlay");
            const startButton = document.getElementById("startButton");
            const restartButton = document.getElementById("restartButton");
            const timeInput = document.getElementById("timeInput");
            const themeToggle = document.getElementById("themeToggle");
            const finalScoreDisplay = document.getElementById("finalScore");
            const reflexesLogDisplay = document.getElementById("reflexesLog");

            let timer;
            let ballCreationTime;
            let bestReflexTime = Infinity;
            let reflexesLog = [];

            // Function to create a ball
            function createBall() {
                const ball = document.createElement("div");
                ball.classList.add("ball");
                const { x, y } = getRandomPosition();
                ball.style.left = `${x}px`;
                ball.style.top = `${y}px`;
                ball.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                ballCreationTime = new Date().getTime();

                ball.addEventListener("click", () => {
                    const clickTime = new Date().getTime();
                    const reactionTime = clickTime - ballCreationTime;
                    reflexesLog.push(reactionTime);
                    if (reactionTime < bestReflexTime) {
                        bestReflexTime = reactionTime;
                        reflexScoreDisplay.textContent = `Best Reflex: ${bestReflexTime} ms`;
                    }
                    ball.classList.add("disappear");
                    setTimeout(() => {
                        if (gameBox.contains(ball)) {
                            gameBox.removeChild(ball);
                        }
                    }, reactionTime / 2);
                });

                gameBox.appendChild(ball);

                // Ball disappears after 3 seconds if not clicked
                setTimeout(() => {
                    if (gameBox.contains(ball)) {
                        gameBox.removeChild(ball);
                    }
                }, 3000);
            }

            // Function to generate random positions for balls
            function getRandomPosition() {
                const x = Math.random() * (gameBox.clientWidth - 50);
                const y = Math.random() * (gameBox.clientHeight - 50);
                return { x, y };
            }

            // Function to start the game timer
            function startTimer() {
                const interval = setInterval(() => {
                    timer--;
                    timerDisplay.textContent = `Timer: ${timer}`;
                    if (timer <= 0) {
                        clearInterval(interval);
                        endGame();
                    }
                }, 1000);
            }

            // Function to end the game
            function endGame() {
                finalScoreDisplay.textContent = `Your best reflex time is: ${bestReflexTime} ms`;
                reflexesLogDisplay.innerHTML = reflexesLog.map(time => `<li>${time} ms</li>`).join('');
                startPopup.style.display = "none";
                endPopup.style.display = "block";
                overlay.style.display = "block";
                bestReflexTime = Infinity;
                reflexesLog = [];
                reflexScoreDisplay.textContent = `Best Reflex: N/A`;
            }

            // Function to start the game
            function startGame() {
                timer = parseInt(timeInput.value, 10);
                timerDisplay.textContent = `Timer: ${timer}`;
                startPopup.style.display = "none";
                endPopup.style.display = "none";
                overlay.style.display = "none";
                startTimer();
                createBall(); // Create the first ball immediately
                setInterval(createBall, 2000); // Continue creating balls every 2 seconds
            }

            // Event listeners
            startButton.addEventListener("click", () => {
                const theme = themeToggle.checked ? "dark" : "light";
                document.body.setAttribute("data-theme", theme);
                startGame();
            });

            restartButton.addEventListener("click", () => {
                startPopup.style.display = "block";
                endPopup.style.display = "none";
            });

            // Show start popup initially
            startPopup.style.display = "block";
            overlay.style.display = "block";
        });
    </script>
</body>

</html>